---
title: "NAT64に対応してみた"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["vyos"]
published: false
publication_name: neody
---

こんにちは、neodylandのtuna2134です。

主にインフラを担当しています。

今回のJANOGでIPv6 Mostly Networkを体験してきました。
その体験でいろいろと面白そうだなと思い、自宅ラボの回線もIPv6 Mostly Networkに変更を試みることにしました。

## インターネット原理主義
もともと、インターネットができた当初、各ユーザー端末にはグローバルIPアドレスを割り当てる想定で、設計されました。しかし、いざ民間に開放した際、足りないと発覚して生まれた技術はNATと呼ばれるプライベートIPアドレスからグローバルIPアドレスに変換する技術です。その後、再びエンドユーザーにグローバルIPアドレスを割り当てが可能になるようIPv6というものが提唱されました。しかし、提唱され、RFCになった当時、IPv6がまともに使える実装がなかったです。そのため、生まれたのが日本人エンジニアが率いるKAMEプロジェクトです。このプロジェクトはBSD系OSにIPv6を対応させようぜという目的で始まりました。

## そもそもIPv6-Mostly-Networkとはなに？
従来だと、IPv4/IPv6 Dual-stack Networkと呼ばれる、IPv4とIPv6をユーザー端末に割り当てて利用していました。今まで出てきたIPv4アドレスの節約法として、MAP-EやDS-Liteが存在します。しかし、最終的に各ユーザー端末にIPv4を割り当てる必要があります。そのため、プライベートアドレスにも限りがあるので、枯渇した際の対策が必要となっていきます。そこで登場したのがNAT64と呼ばれる技術です。これは、各ユーザー端末にはグローバルIPv6アドレスを割り当てておき、IPv4が必要になった際に、IPv6からIPv4に変換する技術が生まれました。しかし、DNSはAレコードしかない場合があります。そこで、DNS64と呼ばれる技術を使います。この技術はAレコードのみしかない場合、DNS64でAAAAレコードも同時に返してくれます。

## レシピ
- AS番号
- IPv4(数個)
- IPv6(/56-/64であれば問題なし)
- VyOSルーター